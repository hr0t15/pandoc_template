<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Title in command line option</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Title in command line option</h1>
</header>
<h1 id="本書の目標">本書の目標</h1>
<p>本書は、以下の事柄を実現できる方法を説明することを目標にします。</p>
<ul>
<li>付番
<ul>
<li>章や節・図・表・リスティングに自動的に付番する。</li>
<li>参照する時、参照対象の番号を自動的に挿入する。</li>
</ul></li>
<li>書式制御
<ul>
<li>付番の書式を制御する。</li>
<li>参照の書式を制御する。</li>
<li>パラグラフの書式を制御する。</li>
</ul></li>
<li>KDPで使える目次を作る。</li>
<li>図表一覧を作る。<br />
ただし、図表へのリンクがありません。用いるツールによる制限です。</li>
</ul>
<p>本書で説明する方法によりEPUBとHTMLを作れます。<br />
本書ではEPUBファイルを表示するためにKindle
Previewerを使います。別途インストールしてください。</p>
<h2 id="変換してみる">変換してみる</h2>
<p>早速Pandocを使ってマークダウンで書かれたファイルをEPUBに変換してみましょう。</p>
<p>以下の二つのファイルを同じフォルダ内に作ってください。sample.mdはマークダウンによる原稿ファイル、crossref.yamlはpandoc-crossrefの制御ファイルです。いずれのファイルも、文字コードがUTF-8でなければなりません。</p>
<p>リスト1: sample.md</p>
<pre><code>#最初の章{#sec:the1st}

「[@sec:the1st]」を参照する。</code></pre>
<p>リスト2: crossref.yaml</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 全体パラメータ</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 参照に参照先へのリンクを付ける。</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">linkReferences</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># セクション用パラメータ</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># true:章番号を付ける</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">numberSections</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="at">  </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 章とみなされる見出しレベル。1なら「#xxx」が章である。</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">chaptersDepth</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 章番号からいくつの見出しレベルに付番するかを指定する。2なら章と節に付番される。</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sectionsDepth</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span></code></pre></div>
<p>コマンドプロンプト（いわゆるDOS窓）を起動し、これらのファイルがあるフォルダに移動してから、下記のコマンドラインを入力して実行してください。</p>
<pre><code>pandoc sample.md  \
  -s  \
  --filter pandoc-crossref  \
  --metadata title=&quot;Title in command line option&quot;  \
  --metadata crossrefYaml=crossref.yaml  \
  --epub-title-page=false  \
  -o result.epub</code></pre>
<p>あっという間に変換が終わります。でき上がったresult.epubをダブルクリックすると、KindlePreviewerで表示されます。</p>
<p>Kindle Previewer の 表示</p>
<h1 id="基本的な使い方">基本的な使い方</h1>
<p>本章では、図を例にとり、付番や参照の書き方などの基本的な事柄を説明します。</p>
<h2 id="図への付番と参照">図への付番と参照</h2>
<h3 id="図への付番">図への付番</h3>
<p>図に番号を与えるには、以下のように書きます。</p>
<pre><code>![caption](imageResourceUrl &quot;imageTitle&quot;){#fig:id} </code></pre>
<p>この書き方の前半部分である「<code>![caption](imageResourceUrl "imageTitle")</code>」は、Markdownの書き方そのものです。
<code>imageTitle</code>を省略してかまいません。<code>caption</code>を省略すると、図タイトルが表示されなくなるだけではなく、参照もできなくなります。</p>
<p>付番にかかわるのはその後ろに付け足された<code>{#fig:id}</code>です。</p>
<ul>
<li>前半部分とこの部分は、空白で区切られていてはなりません。</li>
<li><code>#fig:</code>
は、画像に付番するよう指示する部分で、常にこの通りに書かなければなりません。</li>
<li><code>id</code>
は、この画像を識別するための任意の一語とみなせる文字列であり、文書中でユニークでなければなりません。</li>
<li><code>id</code> は、日本語でもかまいません。</li>
</ul>
<p><code>{#fig:id}</code>
が付けられていない場合、つまり、Markdownのイメージ貼り付けそのままの場合、番号が付けられず、参照もできません。</p>
<h3 id="図の参照">図の参照</h3>
<p>図を参照するには、以下のように書きます。</p>
<pre><code>[@fig:id]</code></pre>
<p><code>id</code> には、画像に付けられたidを指定してください。</p>
<h3 id="例">例</h3>
<p>例としてmonument.jpgという画像ファイルを文書に取り込んで付番し参照する例を掲げます。</p>
<p>リスト3: sample.md</p>
<pre><code>![図のキャプション](monument.jpg){#fig:monumentId}

図の参照：「[@fig:monumentId]」</code></pre>
<p><code>Crossref.yaml</code>
は、前章のものをそのまま使ってください。コマンドラインも同じです。</p>
<p>このMarkdownは、monument.jpgというファイルを取り込んでmonumentIdというIDを与え、その次の行でそれを参照しています。
変換して下図のように表示されれば成功です。</p>
<p>ab図1:画像への付番の例.a—図の表示,b—参照の表示</p>
<p>表示が2ページに分かれているのは、Kindleの仕様によります。</p>
<h2 id="pandoc制御ファイル">Pandoc制御ファイル</h2>
<p>ここまで使ってきたPandocのコマンドラインは、長くて書くのが大変です。
バッチファイルなどのスクリプトを作る手もありますが、それより見てわかりやすい制御ファイルを作りましょう。</p>
<p>リスト 4に制御ファイルの例を掲げます。<br />
ここまで使ってきたコマンドラインのオプションを設定するものです。このファイルの文字コードもUTF-8でなければなりません。</p>
<p>リスト4: pandoc.yaml</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#コマンドラインは、「pandoc -d pandoc.yaml」です。</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">input-files</span><span class="kw">:</span><span class="co">  # 入力ファイルは、sample.mdです。</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> sample.md</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">output-file</span><span class="kw">:</span><span class="at"> result.epub</span><span class="co">  # 出力ファイルは、result.epubです。</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">standalone</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">  # 出力を単体で表示できるようにします。</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">filters</span><span class="kw">:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> pandoc-crossref</span><span class="co">  # pandoc-crossrefを使います。</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">crossrefYaml</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Crossref.yaml&quot;</span><span class="co">  # pandoc-crossrefの制御ファイルです。</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Title in command line option&quot;</span><span class="co">  # ドキュメントタイトルです。</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">number-sections</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">  # Pandocにセクション番号を付けさせません。</span></span></code></pre></div>
<p>このファイルを利用したコマンドラインは、以下のようにとてもシンプルになります。</p>
<pre><code>$ pandoc -d pandoc.yaml</code></pre>
<p><code>-d</code>
オプションによりPandocに制御ファイル名を知らせています。<br />
Pandocは、このファイルの内容をコマンドラインオプションの代わりに取り込んでMarkdownファイルを変換します。</p>
<p>コマンドラインオプションを指定することにより、制御ファイルによる指定をオーバーライドすることもできます。<br />
例えば、制御ファイルで指定されているEPUBファイルではなくHTMLファイルに変換させるには、以下のようなコマンドラインを使います。太字部分で指定した出力ファイル名が制御ファイルで指定されているものをオーバーライドして、<code>result.html</code>というファイルを出力します。</p>
<pre><code>$ pandoc -d Pandoc.yaml -o result.html</code></pre>
<p>これをブラウザで表示すると、図2のようになります。</p>
<p>HTMLファイルの方がEPUBより表示にかかる時間が短いので、執筆中には、変換結果をすばやく確認するためにHTMLファイルを作るようお勧めします。<br />
KDPで出版するならば、もちろん、最終的にはEPUBを作っての確認が必要です。</p>
<h1 id="様々な制御">様々な制御</h1>
<p>前章では、pandoc-crossrefにより図に番号を付けたり、それを参照したりする方法を説明しましたが、色々と直したいところも出てきます。日本語なのですからキャプションに「Figure」ではなく「図」と付けたいですし、参照のリンクが「fig. 1」と数字の部分だけに置かれていては読者に気付いてもらえないかもしれません。
pandoc-crossrefは、制御ファイルを使ってそれらを変更できます。本章では、前章同様、図を例に採ってこのような制御について説明します。</p>
<h2 id="キャプション書式の制御">キャプション書式の制御</h2>
<p>まず、キャプションの書式の構造を説明します。<br />
pandoc-crossrefでは、図のキャプション文字列の構造は、下図のようになっています。</p>
<p>図3:図キャプションの構造</p>
<p>「変数」が前置されているものは、pandoc-crossrefの制御ファイルで設定できます。また、デフォルト値にある
<code>$$xx$$</code>という表記は、「変数<code>xx</code>の値」がその部分に挿入されることを表します。</p>
<p>表1: 図キャプションの部品要素</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>役割</th>
<th>デフォルト</th>
<th>値</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>変数 <code>figureTemplate</code></td>
<td>図キャプションの書式</td>
<td><code>$$figureTitle$$</code> <br>
<code>$$i$$$$titleDelim$$$$t$$</code></td>
</tr>
<tr class="even">
<td>変数 <code>figureTitle</code></td>
<td>キャプションに前置される文字列</td>
<td><code>Figure</code></td>
</tr>
<tr class="odd">
<td>変数 <code>titleDelim</code></td>
<td>前置される文字列と番号を区切る文字列</td>
<td><code>:</code></td>
</tr>
<tr class="even">
<td>図の連番i</td>
<td>図に付番された番号</td>
<td><code>NA</code></td>
</tr>
<tr class="odd">
<td>キャプションt</td>
<td>Markdown中に書かれたキャプション</td>
<td><code>NA</code></td>
</tr>
</tbody>
</table>
<p>図2に表示されている図のキャプションは、変数<code>figureTemplate</code>で指定される書式に従って作られた文字列です。
デフォルト値では、変数 <code>figureTitle</code> が <code>Figure</code>
、変数 <code>titleDelim</code>が <code>:</code>
ですから、図2に示したように、図に付けられるキャプションは「<code>Figure</code>図番号:Markdownに書かれたキャプション」となります。<br />
ここで、「図番号」は、pandoc-crossrefが自動的に図に与えた番号の文字列です。</p>
<p>図キャプションの書式は変数<code>figureTemplate</code>で決まるのですから、そのデフォルト値がしているように変数<code>FigureTitle</code>等の他の変数を参照する必要は、必ずしもありません。
例えば、変数<code>figureTemplate</code>に含まれている<code>$$titleDelim$$</code>を<code>:</code>に置き換えても、同じキャプションを作れます。
変数<code>figureTemplate</code>の値を書き換えるには、pandoc-crossrefの制御ファイルに変数名をキーとするハッシュを書きます。前章のサンプルですと、下記の行をcrossref.yamlに書き加えることになります。</p>
<p>リスト5:変数<code>titleDelim</code>を使わない例</p>
<pre><code># このハッシュは、変数の値を書き換えます。
figureTemplate: $$i$$: $$t$$  # 変数titleDelimの代わりに、直接「:」を書きました。</code></pre>
<p>ただし、変数<code>titleDelim</code>は表など他の種類のキャプションの区切り記号にも統一感を出すために使われていますので、できるだけこの変数を利用するようお勧めします。</p>
<h3 id="番号の文字種">番号の文字種</h3>
<p>図番号の文字種を制御するには、変数<code>figLabels</code>を用います。設定する値と番号の形式を下表に掲げます。</p>
<p>表2:番号文字の文字種</p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>設定する値</th>
<th>制御ファイルでの書き方例</th>
<th>表示例</th>
<th>メモ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>arabic</code></td>
<td><code>figLabel:arabic</code></td>
<td>1,2,3…</td>
<td></td>
</tr>
<tr class="even">
<td><code>roman</code></td>
<td><code>figLabel:roman</code></td>
<td>I,II,III,IV,…</td>
<td></td>
</tr>
<tr class="odd">
<td><code>lowercase</code></td>
<td><code>figLabel:lowercase</code></td>
<td>i,ii,iii,iv,…</td>
<td></td>
</tr>
<tr class="even">
<td><code>alpha x</code></td>
<td><code>figLabel:alpha d</code></td>
<td>d,e,f,…</td>
<td></td>
</tr>
<tr class="odd">
<td>列挙</td>
<td><code>figLabel:[イ,ロ,ハ,ニ]</code></td>
<td>イ,ロ,ハ,ニ</td>
<td>使うものすべてを列挙してください。</td>
</tr>
</tbody>
</table>
<h3 id="連番の振り方">連番の振り方</h3>
<p>図番号は、文書全体での連番、または、各章などの中での連番です。</p>
<p>変数<code>chapters</code>により、どちらにするかを決められます。なお、変数<code>chapters</code>は表や式などの付番にも影響しますので、ご注意ください。</p>
<p>表3:連番の振り方</p>
<table>
<thead>
<tr class="header">
<th>変数chaptersの値</th>
<th>連番の振り方</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>false</code></td>
<td>文書内全体を通しての連番（デフォルト値）</td>
</tr>
<tr class="even">
<td><code>true</code></td>
<td>章や節ごとに1番から始まる連番</td>
</tr>
</tbody>
</table>
<p>変数<code>chapters</code>が<code>true</code>の時には、以下のような形で連番が付けられます。</p>
<p>図4:章ごとの連番</p>
<p>章や節のどの範囲で連番を付けるかは、変数<code>chaptersDepth</code>で決められます。この変数には、番号をリセットしたいヘッダレベルを設定してください。例えば、ヘッダレベル1を章に割り当てている場合、表4のようになります。</p>
<p>表4:連番の範囲</p>
<table>
<thead>
<tr class="header">
<th>変数<code>chaptersDepth</code>の値</th>
<th>連番の範囲</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>文書全体を通じて連番を付加する。</td>
</tr>
<tr class="even">
<td>1</td>
<td>章ごとに番号をリセットし、図番号に章番号を付加する。デフォルト値。</td>
</tr>
<tr class="odd">
<td>2</td>
<td>節ごとに番号をリセットし、図番号に章番号と節番号を付加する。</td>
</tr>
<tr class="even">
<td>3</td>
<td>以上項番号ごとなどになり、以下同様。</td>
</tr>
</tbody>
</table>
<p>章ごとなどの連番の場合に章番号と連番を区切る文字は、変数<code>chapDelim</code>の値で、デフォルト値は<code>.</code>です。</p>
<h2 id="参照書式の制御">参照書式の制御</h2>
<p>pandoc-crossrefでは、図の参照文字列の構造は、下図のようになっています。</p>
<p>図2に表示されている図の参照には、変数refIndexTemplateに従って作られた文字列が使われています。デフォルト値では変数<code>figPrefixTemplate</code>が<code>$$p$$&amp;nbsp;$$i$$</code>、変数<code>figPrefix</code>が<code>fig.</code>ですから、「fig. 図番号」となります。
なお、<code>&amp;nbsp;</code>は、改行を許さない空白文字です。</p>
<p>表5:参照文字列部品</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>要素</th>
<th>役割</th>
<th>デフォルト値</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>変数 <code>refIndexTemplate</code></td>
<td>参照文字列の書式</td>
<td><code>$$i$$$$suf$$</code></td>
</tr>
<tr class="even">
<td>変数 <code>figPrefixTemplate</code></td>
<td>図番号の書式</td>
<td><code>$$p$$ $$i$$</code></td>
</tr>
<tr class="odd">
<td>変数 <code>figPrefix</code></td>
<td>連番に付けるプレフィックス</td>
<td><code>fig.</code>, <code>figs</code></td>
</tr>
<tr class="even">
<td>サフィックス <code>suf</code></td>
<td>参照の中に書かれたsuffix</td>
<td><code>NA</code></td>
</tr>
<tr class="odd">
<td>キャプション <code>t</code></td>
<td>参照先の図のキャプション</td>
<td><code>NA</code></td>
</tr>
<tr class="even">
<td>図の連番<code>i</code>(<code>figPrefixTemplate</code>内)</td>
<td>参照先の図に付けられた連番</td>
<td><code>NA</code></td>
</tr>
<tr class="odd">
<td>整形済連番<code>i</code>(<code>refIndexTemplate</code>内)</td>
<td>変数<code>figPrefixTemplate</code>の評価値</td>
<td><code>NA</code></td>
</tr>
</tbody>
</table>
<h3 id="変数figprefix">変数<code>figPrefix</code></h3>
<p>参照に付けられるプレフィックスを指定する変数<code>figPrefix</code>は、単数形と複数形を指定できる
リストです。</p>
<p>複数形は、4.4節で説明するように、複数の図を参照する場合に用いられます。
制御ファイル内に書くと、以下のようになります。</p>
<pre><code>figPrefix:
-fig.
-figs.</code></pre>
<p>複数形がなければ、以下のように単なる変数としても問題ありません。</p>
<pre><code>figPrefix:図</code></pre>
<h3 id="サフィックス">サフィックス</h3>
<p>サフィックスは、それぞれの参照で指定する、図番号の後ろに付ける文字列です。</p>
<p>通常の参照の書き方は<code>[@fig:id]</code>ですが、<code>[@fig:idsuffix]</code>のようにサフィックスとして任意の文字列を付け加えることができます。サフィックスをダブルクォーテーションで括らないでください。括ると、ダブルクォーテーションもサフィックスの一部とみなされます。サフィックス文字列の中に2個以上連続した空白文字がある場合、1個にまとめられます。</p>
<p>例えば、図2にある参照を書く時に<code>[@fig:monumentIdThisissuffix]</code>と書けば、参照の文字列が以下のようになります。</p>
<pre><code>fig. 1 This is suffix</code></pre>
<h3 id="プレフィックス変更">プレフィックス変更</h3>
<p>変数<code>figPrefix</code>で決まる参照のプレフィックス部分を、それぞれの参照でオーバーライドできます。<br />
通常プレフィックスには変数<code>figPrefix</code>の値が使われて「fig. 1」となりますが、参照時に<code>[myprefix@fig:monumentId]</code>と書くと、変数<code>figPrefix</code>の代わりに参照に書かれたプレフィックスが使われて<code>myprefix1</code>となります。プレフィックスもサフィックスと同様に任意の文字列を書けます。ダブルクォーテーションも文字列の一部とみなされることと複数の連続する空白が一つにまとめられることも同じです。</p>
<p>プレフィックスとサフィックスの両方を一つの参照に指定できます。</p>
<h3 id="プレフィックス抑制">プレフィックス抑制</h3>
<p>以下の書き方をすると、参照内にプレフィックスを表示しません。</p>
<p>リスト6:プレフィックスを抑制する記法</p>
<pre><code>[-@fig:monumentId]</code></pre>
<p>このように書くと、図5の中段にある変数<code>figPrefixTemplate</code>が省略されて、図番号が上段にある変数<code>refIndexTemplate</code>の「<code>$$i$$</code>」の値として使われます。</p>
<p>「<code>-</code>」の後ろに空白文字を置くと、プレフィックス変更と解釈されてしまいます。間を開けずに書きましょう。</p>
<h3 id="キャプションを含める">キャプションを含める</h3>
<p>変数<code>t</code>を用いて、参照書式に図のキャプションを含めることができます。変数<code>t</code>は、変数<code>refIndexTemplate</code>など書式を決める変数の定義の中でのみ使えます。</p>
<p>変数<code>refIndexTemplate</code>のデフォルト値は「<code>$$i$$$$suf$$</code>」ですが、これに「<code>$$t$$</code>」を付け加えて「<code>$$i$$$$suf$$$$t$$</code>」とすると、参照書式が以下のようになります。</p>
<pre><code>「fig. 1図のキャプション」</code></pre>
<h2 id="種類ごとの参照書式">種類ごとの参照書式</h2>
<p>参照書式を決める変数refIndexTemplateはシンプルな文字列として書式を保持していますから、それを変更すると、図だけではなく表や式などにも影響します。これを避けるには、この変数を、図専用の書式とそれ以外の書式を区別して保持するディクショナリーにします。</p>
<p>リスト7:refIndexTemplateをディクショナリーにする</p>
<pre><code>refIndexTemplate:
  fig: $$i$$$$suf$$&amp;nbsp;$$t$$
  default: $$i$$$$suf$$</code></pre>
<p>このようにしておけば、図の参照書式だけにキャプションが表示されるようになります。</p>
<p>表や式などにもそれぞれ異なる参照書式を使いたい場合には、下表のように書いてディクショナリーに追加すれば実現できます。</p>
<p>変数refIndexTemplateの値の中だけで使える変数t・suf・iは、図と同様に表や式などでも使えます。</p>
<p>表6:種類ごとの参照書式</p>
<table>
<thead>
<tr class="header">
<th>要素</th>
<th>書き方の例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>図</td>
<td><code>fig: $$i$$$$suf$$ $t$$</code></td>
</tr>
<tr class="even">
<td>表</td>
<td><code>tbl: $$i$$:$$t$$</code></td>
</tr>
<tr class="odd">
<td>式</td>
<td><code>eq: $$i$$</code></td>
</tr>
<tr class="even">
<td>リスティング</td>
<td><code>lst:$$i$$ $$t$$</code></td>
</tr>
<tr class="odd">
<td>章や節</td>
<td><code>suf: $$i$$$$suf$$$$t$$</code></td>
</tr>
<tr class="even">
<td>定義されていない要素すべて</td>
<td><code>default: $$i$$$$suf$$</code></td>
</tr>
</tbody>
</table>
<h2 id="参照の制御">参照の制御</h2>
<p>この節では、書式以外の点で図などへの参照を制御する方法を説明します。</p>
<h3 id="参照からリンクを張る">参照からリンクを張る</h3>
<p>pandoc-crossrefのデフォルトでは、図番号への参照から図へのリンクが張られません。リンクを張るには、変数<code>linkReference</code>を<code>true</code>にしなければなりません。pandoc-crossrefの制御ファイルであるcrossref.yamlに、以下の行を追加しましょう。</p>
<p>リスト8:参照からリンクを張るための設定</p>
<pre><code>linkReference: true</code></pre>
<p>この設定は、表や式などにも有効です。</p>
<h3
id="プレフィックスもリンクに含める">プレフィックスもリンクに含める</h3>
<p>参照のリンクは、図2に示すように、参照文字列の番号の部分だけにしか置かれていません。これではクリックしにくいですし、図番号と言えばプレフィックスまで含めて考えるのが普通でしょう。</p>
<p>変数<code>nameInLink</code>を<code>true</code>にすることにより、プレフィックスにもリンクが置かれるようになります。
pandoc-crossrefの制御ファイルであるcrossref.yamlに、以下の行を追加しましょう。</p>
<p>リスト9:参照のプレフィックスにもリンクを置くための設定</p>
<pre><code>nameInLink: true</code></pre>
<p>このようにすると、図2の参照とは異なり図6のようにプレフィックスの部分にもアンダーラインが引かれて、リンクが置かれていることが分かります。</p>
<p>図6:プレフィックスにもリンク</p>
<p>参照にサフィックスを書いている場合には、サフィックスの部分にもリンクが置かれます。</p>
<p>この設定は、表や式などにも有効です。</p>
<h3 id="複数参照">複数参照</h3>
<p>複数の図に対する参照をまとめて書くことができます。</p>
<pre><code>単独の参照: [@fig:id1]
複数の参照: [@fig:id1;@fig:id2;…]</code></pre>
<p>参照を括る大括弧の中に複数の参照先をセミコロンで区切って書くだけです。</p>
<p>表2に示す番号の文字種がarabicの場合、連番の図が参照される時には全部を列挙するのではなく、それらをまとめて範囲を表示にされます。連番でなければ、カンマで区切って列挙されます。</p>
<p>例を下表に示します。</p>
<p>複数参照の例{#tbl: 複数参照の例}</p>
<table>
<thead>
<tr class="header">
<th>参照する数</th>
<th>参照表記</th>
<th>参照文字列</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1個</td>
<td><code>[@fig:id1]</code></td>
<td>fig. 1</td>
</tr>
<tr class="even">
<td>連番2個</td>
<td><code>[@fig:id1;@fig:id2]</code></td>
<td>figs.1,2</td>
</tr>
<tr class="odd">
<td>連番3個</td>
<td><code>[@fig:id1;@fig:id2;@fig:id3]</code></td>
<td>figs.1-3</td>
</tr>
<tr class="even">
<td>飛び番2個</td>
<td><code>[@fig:id1;@fig:id3]</code></td>
<td>figs.1,3</td>
</tr>
<tr class="odd">
<td>飛び番3個</td>
<td><code>[@fig:id1;@fig:id3;@fig:id5]</code></td>
<td>figs.1,3,5</td>
</tr>
<tr class="even">
<td>混合4個</td>
<td><code>[@fig:id1;@fig:id2;@fig:id3;@fig:id5]</code></td>
<td>figs.1-3,5</td>
</tr>
</tbody>
</table>
<p>連番や飛び番の区切り文字は、以下の変数により設定できます。</p>
<p>連番や飛び番の区切り文字{#tbl:連番や飛び番の区切り文字}</p>
<table style="width:100%;">
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="header">
<th>変数名</th>
<th>役割</th>
<th>デフォルト値</th>
<th>例</th>
<th>変更例</th>
<th>変更した表示</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>rangeDelim</code></td>
<td>3個以上の連番の時に範囲を示す区切り文字</td>
<td><code>-</code></td>
<td>figs.1-3</td>
<td><code>to</code></td>
<td>figs.1to3</td>
</tr>
<tr class="even">
<td><code>pairDelim</code></td>
<td>2個を列挙する時の区切り文字</td>
<td><code>,</code></td>
<td>figs.1,3</td>
<td><code>and</code></td>
<td>figs.1 and 3</td>
</tr>
<tr class="odd">
<td><code>refDelim</code></td>
<td>3個以上を列挙する時の最後以外の区切り文字</td>
<td><code>,</code></td>
<td>figs.1,3,5</td>
<td><code>,</code></td>
<td>figs.1,3,5</td>
</tr>
<tr class="even">
<td><code>lastDelim</code></td>
<td>3個以上を列挙する時の最後の区切り文字</td>
<td><code>,</code></td>
<td>figs.1,3,5</td>
<td><code>, and</code></td>
<td>figs.1,3, and5</td>
</tr>
</tbody>
</table>
<p>それぞれの区切り文字と図番号の間には、空白文字を含めて自動的には何も表示されません。読みやすくするために、区切り文字の前後に適切な空白文字を含めるようお勧めします。変数refDelimの変更例には、空白文字を置かなかった場合の表示を掲げてみました。</p>
<p>上記の変更例を設定するpandoc-crossref設定ファイルの記述は、以下の通りです。</p>
<p>リスト10:連番などの区切り文字を設定する</p>
<pre><code>rangeDelim: &quot;to&quot;
pairDelim: &quot;and&quot;
refDelim: &quot;,&quot;
lastDelim:&quot;,and&quot;</code></pre>
<h2 id="生成されるhtml">生成されるHTML</h2>
<p>本書ではPandocが生成するHTMLを掲載します。図や表に対して生成されるHTMLの構造が分かれば、CSSを使って望みの見た目を作れるからです。</p>
<p>本書で掲載するHTMLは、Pandocが生成したものそのままではなく、わかりやすいように整形しています。HTMLタグの順序・入れ子・兄弟関係・属性などは生成されたままですが、改行を挿入したり、空白を挿入削除したりしています。</p>
<h3 id="図番号のhtml">図番号のHTML</h3>
<p>既出の通り、図番号付きで画像を取り込むMarkdownは、以下の通りです。</p>
<p>リスト11:図番号付きの画像</p>
<pre><code>![図のキャプション](monument.jpg &quot;imageTitle&quot;){#fig:monumentId}</code></pre>
<p>このMarkdownに対して、以下のHTMLが生成されます。</p>
<p>リスト12:図番号付き画像のHTML</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">figure</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;fig:monumentId&quot;</span><span class="dt">&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">img</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;monument.jpg&quot;</span><span class="ot"> title</span><span class="op">=</span><span class="st">&quot;imageTitle&quot;</span><span class="ot"> alt</span><span class="op">=</span><span class="st">&quot;図のキャプション&quot;</span><span class="dt">&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">figcaption</span><span class="dt">&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        Figure1:図のキャプション</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">figcaption</span><span class="dt">&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">figure</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Markdownで指定したIDがfigureタグのid属性で設定されています。
キャプションは、figcaption要素とimg要素のalt属性に設定されています。
図を表示するimg要素とキャプションは、figure要素内にまとめられています。第4.5.2項図番号参照のHTML図を参照するMarkdownは、以下の通りです。</p>
<p>リスト13:図参照</p>
<pre><code>[@fig:monumentId]</code></pre>
<p>このMarkdownに対して生成されるHTMLは、図に番号がついている場合、以下の通りです。</p>
<p>リスト14:図参照のHTML</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">&quot;#fig:monumentId&quot;</span><span class="dt">&gt;</span>fig.<span class="dv">&amp;nbsp;</span>1<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span></code></pre></div>
<p>図の参照は、単純にa要素で表現されています。</p>
<p>a要素のコンテントは、4.2節に示した方法で作られた文字列です。</p>
<h3 id="表現を変更する">表現を変更する</h3>
<p>HTMLの構造が分かれば、CSSで表現を変えることができます。例として、図2では画面の左側に寄っている図を中央寄せして、図の範囲が分かりやすいように線で囲ってみましょう。</p>
<p>以下の内容のファイルpandoc.cssを作ってください。文字コードは、UTF-8でなければなりません。</p>
<p>リスト15:pandoc.css</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>&lt;style<span class="op">&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    figure{</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">padding-top</span><span class="ch">:</span> <span class="dv">0.5</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#404040</span><span class="op">;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">text-align</span><span class="ch">:</span> <span class="dv">center</span><span class="op">;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>&lt;/style<span class="op">&gt;</span></span></code></pre></div>
<p>そして、pandoc.yamlに以下の二行を追加します。</p>
<p>リスト16:CSS取り込み</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">include-in-header</span><span class="kw">:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> InHeader.css</span></span></code></pre></div>
<p><code>include-in-header</code>により、pandoc.cssの内容が生成されたEPUBやHTMLに挿入されます。
挿入場所はPandocが自動的に挿入するstyle要素の直後ですから、元々Pandocが定義している表現をオーバーライドできます。</p>
<p>EPUBやHTMLを生成させると、図2の表示が下図のように変わります。</p>
<p>図2と比べると、画像の表現が変わっていることがはっきりわかります。
このように、生成されるHTMLの特徴を利用して表現を変えることができます。</p>
<p>なお、参照側は単純にaタグを使っていますので、CSSで表現を変えるとすべてのリンクの書式が変わってしまいます。図のリンクの書式だけを変えることはできません。</p>
<h1 id="kdp用原稿のための配慮">KDP用原稿のための配慮</h1>
<h2 id="タイトルページを消す">タイトルページを消す</h2>
<p>KDPでは、原稿登録時に、表紙を本文とは別に指定します。
ですから、中表紙とみなすなら別ですが、EPUBに表紙を含めてはいけません。</p>
<p>Pandocのデフォルトでは表紙を作るようになっていますから、これを消しましょう。</p>
<p>コマンドラインに<code>--epub-title-page=false</code>というオプションを追加して消します。</p>
<pre><code>pandoc -d Pandoc.yaml --epub-title-page=false</code></pre>
<p>Pandocのドキュメントでは、このオプションをpandoc.yamlにも書けることになっていますが、残念ながらVersion.3.1.2で確認してみるとエラーになってしまいます。コマンドラインで指定しましょう。</p>
<h2 id="目次を消す">目次を消す</h2>
<p>KDPにEPUBを登録する時には目次が必須ですが、ナビゲーション用の目次が用意されていれば良いのであって、本文中に目次が含まれていなければならないということではありません。
PandocでEPUBを作ると、ナビゲーション用の目次は必ず作られます。
本文の一部として目次を作るか否かは著者が決めて問題ありません。
特に書籍が大きい場合には目次が長くなりがちです。そのような時には目次を本文から削除したくなります。</p>
<p>目次を本文から削除するには、pandoc.yamlに以下の行を追加してください。</p>
<pre><code>toc:false</code></pre>
<p>これで本文から目次が削除されます。
この設定にかかわらず、ナビゲーション用の目次は作られますので、KDPの要件は満たされます。</p>
<h2 id="図表一覧を作る">図表一覧を作る</h2>
<p>Markdownの適当なところにコマンドを挿入することにより、図・表・リスティングの一覧を作れます。
表とリスティングの一覧の作り方は図一覧とほぼ同一ですから、以下では図一覧について説明します。</p>
<p>表とリスティングの一覧については、表25に掲げる対応表をご覧ください。
残念なことに、図表一覧から各図などへのリンクは、張られません。</p>
<h3 id="図一覧のmarkdown">図一覧のMarkdown</h3>
<p>図一覧のMarkdownは、以下の通りです。</p>
<pre><code>\listoffigures</code></pre>
<p>5.7.3項のリスト 38で例示に使った図の一覧を作ると、図44の様に表示されます。</p>
<p>図44:図一覧</p>
<p>このように、図一覧には、図だけではなくサブフィギュアも含まれます。</p>
<h3 id="図一覧の書式制御">図一覧の書式制御</h3>
<h4 id="図一覧のタイトル">図一覧のタイトル</h4>
<p>図表一覧のタイトルは、変数<code>lofTitle</code>の値です。<br />
デフォルト値は<code># List of Figures</code>です。<br />
先頭の<code>#</code>は、レベル1のヘッダを表すMarkdown記法です。</p>
<h4 id="図一覧本体の書式">図一覧本体の書式</h4>
<p>図一覧の各行は、以下の構造により作られます。</p>
<p>図45:図一覧本体の書式</p>
<p>図番号は、図5に掲げる変数<code>refIndexTemplate</code>による書式制御に従います。
つまり、4.2節で説明した図を参照する時と同じ書式になります。
ただし、pandoc-crossrefがプレフィックスとサフィックスを付けないので、結果的には図45の構造になっています。
この構造は、プレフィックスを省略する参照のMarkdown「<code>[-@fig:id]</code>」を書いた時と同じものです。</p>
<p>サブフィギュアの場合には、以下の構造により作られます。</p>
<p>図46:図一覧本体中サブフィギュアの書式</p>
<p>サブフィギュアがある場合には、図40に掲げる変数<code>subfigureRefIndexTemplate</code>に従って作られた文字列が使われます。
こちらもpandoc-crossrefがプレフィックスとサフィックスを付けないので、結果的に図46の構造になっています。
こちらも、プレフィックスを省略する参照のMarkdown「<code>[-@fig:subfigid]</code>」を書いた時と同じものです。</p>
<p>表24:図一覧の各行の文字列の部品</p>
<table>
<thead>
<tr class="header">
<th>要素</th>
<th>役割</th>
<th>デフォルト値</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>変数<code>lofItemTitle</code></td>
<td>各行の先頭に付ける文字列</td>
<td>空文字列</td>
</tr>
<tr class="even">
<td>変数<code>listItemTitleDelim</code></td>
<td>参照文字列とキャプションを区切る文字列</td>
<td><code>.</code></td>
</tr>
</tbody>
</table>
<p>他の部品については、5.2節の表9と5.7節の表22をご覧ください。</p>
<h3 id="生成される図一覧のhtml">生成される図一覧のHTML</h3>
<p>図の一覧は、一つずつの図などごとにbr要素で改行されているだけの単なる文字列をdiv要素で括ったものです。</p>
<p>リスト42:図一覧のHTML</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>ListofFigures<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;listlist-of-fig&quot;</span><span class="dt">&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>1. GroupCaption<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>1 (a). BigCaption1<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>1 (b). MiddleCaption1<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>1 (c). SmallCaption1<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>1 (d). BigCaption1<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>図一覧のタイトルは、変数<code>lofTitle</code>のデフォルト値の通り、レベル1のヘッダになっています。
図一覧本体を括るdiv要素には、図一覧であることを
表すクラスが付けられます。</p>
<h3 id="図表一覧の書式制御まとめ">図表一覧の書式制御まとめ</h3>
<p>表とリスティングの一覧も図一覧と同じ方法で作れます。
表25に記法や書式制御変数の対応表を掲げます。</p>
<p>表25:図表一覧の記法対応表</p>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="header">
<th>一覧</th>
<th>Markdown記法</th>
<th>行タイトル</th>
<th>番号の書式</th>
<th>div要素のクラス</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>図</td>
<td><code>\listoffigures</code></td>
<td>変数<code>lofItemTitle</code></td>
<td>変数<code>refIndexTemplate</code></td>
<td><code>list list-of-fig</code></td>
</tr>
<tr class="even">
<td>図（サブフィギュアの場合）</td>
<td><code>-</code></td>
<td>同上</td>
<td>変数<code>subfigureRefIndexTemplate</code></td>
<td><code>-</code></td>
</tr>
<tr class="odd">
<td>表</td>
<td><code>\listoftables</code></td>
<td>変数<code>lotItemTitle</code></td>
<td>変数<code>refIndexTemplate</code></td>
<td><code>list list-of-tbl</code></td>
</tr>
<tr class="even">
<td>リスティング</td>
<td><code>\listoflistings</code></td>
<td>変数<code>lolItemTitle</code></td>
<td>変数<code>refIndexTemplate</code></td>
<td><code>list list-of-lst</code></td>
</tr>
</tbody>
</table>
<p>変数<code>refIndexTemplate</code>が連番の書式として図・表・リスティングのすべてに使われていますが、種類ごとに連番の書式を変えたい場合には4.3節で説明したように、変数<code>refIndexTemplate</code>をディクショナリーにしてください。</p>
<h1 id="付録">付録</h1>
<p>参考のために、本書で利用した制御ファイルと、それらを利用する際の注意事項を掲載します。</p>
<h2 id="pandoc制御ファイル-1">Pandoc制御ファイル</h2>
<p>リスト43:Pandoc制御ファイル</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">input-files</span><span class="kw">:</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> Prologue.md</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> Chapter1.md</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> Chapter2.md</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> Chapter3.md</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> Chapter4.md</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> Chapter5.md</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> Chapter6.md</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> Appendix.md</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">standalone</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">from</span><span class="kw">:</span><span class="at"> markdown+multiline_tables</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">filters</span><span class="kw">:</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> pandoc-crossref</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">crossrefYaml</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;crossref_ config. yaml&quot;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Title in command line option&quot;</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc-title</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;目次&quot;</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">language</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;ja-JP&quot;</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="fu">include-in-header</span><span class="kw">:</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> InHeader.css</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="fu">html-math-method</span><span class="kw">:</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">method</span><span class="kw">:</span><span class="at"> mathml</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="fu">number-sections</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="fu">variables</span><span class="kw">:</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">indent</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="at"> </span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span></code></pre></div>
<h2 id="pandoc-crossref制御ファイル">pandoc-crossref制御ファイル</h2>
<p>リスト 44: pandoc-corssref制御ファイル</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># セクション用パラメータ</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">numberSections</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chaptersDepth</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sectionsDepth</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">secPrefixTemplate</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;$$i$$&quot;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">secLabels</span><span class="kw">:</span><span class="at"> arabic</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">secHeaderTemplate</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;第$$i$$$$secHeaderDelim[n]$$$$t$$&quot;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">secHeaderDelim</span><span class="kw">:</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;章&amp;#32;&quot;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;節&amp;#32;&quot;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;項&amp;#32;&quot;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot; &quot;</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 図用パラメータ</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="fu">figureTitle</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;図 &quot;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="fu">figPrefix</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;図&quot;</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="fu">figPrefixTemplate</span><span class="kw">:</span><span class="at"> $$p$$$$i$$</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 表用パラメータ</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="fu">tableTitle</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;表&quot;</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="fu">tblPrefix</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;表&quot;</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="fu">tblPrefixTemplate</span><span class="kw">:</span><span class="at"> $$p$$$$i$$</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 参照用パラメータ</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="fu">refIndexTemplate</span><span class="kw">:</span><span class="at"> $$i$$$$suf$$</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="co"># リスティング用パラメータ</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="fu">codeBlockCaptions</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="fu">listingTitle</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;リスト&quot;</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lstPrefix</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;リスト&quot;</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 全体用パラメータ</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="fu">linkReferences</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="fu">nameInLink</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div>
<h2 id="追加のcssファイル">追加のCSSファイル</h2>
<p>本文中に掲載したHTMLの構造を利用して、スタイルを適用する対象を選ぶようにしています。</p>
<p>リスト45:追加のCSSファイル</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>&lt;style<span class="op">&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== 全体調整 ====*/</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* 全体の幅などを調整する */</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    body {</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">width</span><span class="ch">:</span> <span class="bu">initial</span><span class="op">;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">100</span><span class="dt">%</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">max-height</span>: <span class="dv">100</span><span class="dt">%</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* 改ページ */</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.breakpage</span> {</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-before</span><span class="ch">:</span> <span class="dv">page</span><span class="op">;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    p {</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0.7</span><span class="dt">em</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">text-align</span><span class="ch">:</span> <span class="dv">left</span><span class="op">;</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== ヘッダ ====*/</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    h1 {</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-before</span><span class="ch">:</span> <span class="dv">page</span><span class="op">;</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border-bottom</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">px</span> <span class="dv">solid</span><span class="op">;</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-after</span><span class="ch">:</span> <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    h2 {</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.6</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">text-decoration</span><span class="ch">:</span> <span class="dv">underline</span><span class="op">;</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-after</span><span class="ch">:</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>        <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    h3 {</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.5</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">text-decoration</span><span class="ch">:</span> <span class="dv">underline</span><span class="op">;</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-after</span><span class="ch">:</span> <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>    h4 {</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.4</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">text-decoration</span><span class="ch">:</span> <span class="dv">underline</span><span class="op">;</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-after</span><span class="ch">:</span> <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>    h5 {</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin-block-end</span><span class="ch">:</span> <span class="dv">0</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>        <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.2</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>        <span class="kw">font-weight</span><span class="ch">:</span> <span class="dv">bold</span><span class="op">;</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-after</span><span class="ch">:</span> <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== div要素による制御 ====*/</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* div要素によりパラグラフの位置と背景色を制御する。 */</span></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>    div<span class="fu">.indentedColoredBox</span> {</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>        <span class="kw">background</span><span class="ch">:</span> <span class="cn">#f0f0f0</span><span class="op">;</span></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin-left</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>    div<span class="fu">.indented</span> {</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin-left</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== 図の書式 ====*/</span></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>    figure {</span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>        <span class="kw">text-align</span><span class="ch">:</span> <span class="dv">center</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== リスティングの書式 ====*/</span></span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* リスティングを少し右寄せにする。 */</span></span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>    div<span class="fu">.listing</span> {</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin-left</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">padding</span><span class="ch">:</span> <span class="dv">0</span></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* キャプションをリスティング部分にぴったり寄せる。 */</span></span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>    div<span class="fu">.listing</span> <span class="op">&gt;</span> p {</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">em</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span></span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* リスティング部分の余分な余白をなくし、背景に色を付ける。 */</span></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>    div<span class="fu">.listing</span> <span class="op">&gt;</span> pre {</span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>        <span class="kw">background</span><span class="ch">:</span> <span class="cn">#f0f0f0</span><span class="op">;</span></span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span></span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== 図の書式 ====*/</span></span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a>    figure <span class="op">&gt;</span> img {</span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-after</span><span class="ch">:</span> <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a>    img {</span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#404040</span><span class="op">;</span></span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== リスト ====*/</span></span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* リスト内のイメージを少し右に寄せる。 */</span></span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a>    li <span class="op">&gt;</span> img {</span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin-left</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== 表の書式 ====*/</span></span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a>    table {</span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0.5</span><span class="dt">em</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border-collapse</span><span class="ch">:</span> <span class="dv">collapse</span><span class="op">;</span></span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a>        <span class="kw">overflow-x</span><span class="ch">:</span> <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a>        <span class="kw">display</span><span class="ch">:</span> <span class="dv">block</span><span class="op">;</span></span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border</span><span class="ch">:</span> <span class="dv">0</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-inside</span><span class="ch">:</span></span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a>        <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a>    table caption {</span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin-bottom</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border-bottom</span><span class="ch">:</span> <span class="dv">thick</span><span class="op">;</span></span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a>        <span class="kw">font-weight</span><span class="ch">:</span> <span class="dv">bold</span><span class="op">;</span></span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-after</span><span class="ch">:</span> <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-113"><a href="#cb33-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-114"><a href="#cb33-114" aria-hidden="true" tabindex="-1"></a>    thead tr {</span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span><span class="op">;</span></span>
<span id="cb33-116"><a href="#cb33-116" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-117"><a href="#cb33-117" aria-hidden="true" tabindex="-1"></a>    thead th {</span>
<span id="cb33-118"><a href="#cb33-118" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border-left</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">dotted</span><span class="op">;</span></span>
<span id="cb33-119"><a href="#cb33-119" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border-right</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">dotted</span><span class="op">;</span></span>
<span id="cb33-120"><a href="#cb33-120" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border-bottom</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">px</span> <span class="dv">solid</span><span class="op">;</span></span>
<span id="cb33-121"><a href="#cb33-121" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-122"><a href="#cb33-122" aria-hidden="true" tabindex="-1"></a>    thead <span class="op">+</span> tbody {</span>
<span id="cb33-123"><a href="#cb33-123" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin-top</span><span class="ch">:</span> <span class="bu">initial</span><span class="op">;</span></span>
<span id="cb33-124"><a href="#cb33-124" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border-top</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#1a1a1a</span><span class="op">;</span></span>
<span id="cb33-125"><a href="#cb33-125" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border-bottom</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#1a1a1a</span><span class="op">;</span></span>
<span id="cb33-126"><a href="#cb33-126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-127"><a href="#cb33-127" aria-hidden="true" tabindex="-1"></a>    thead <span class="op">+</span> tbody tr {</span>
<span id="cb33-128"><a href="#cb33-128" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span><span class="op">;</span></span>
<span id="cb33-129"><a href="#cb33-129" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-130"><a href="#cb33-130" aria-hidden="true" tabindex="-1"></a>    thead <span class="op">+</span> tbody td {</span>
<span id="cb33-131"><a href="#cb33-131" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">dotted</span><span class="op">;</span></span>
<span id="cb33-132"><a href="#cb33-132" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-133"><a href="#cb33-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-134"><a href="#cb33-134" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== リスティング ====*/</span></span>
<span id="cb33-135"><a href="#cb33-135" aria-hidden="true" tabindex="-1"></a>    div<span class="fu">.listing</span> p {</span>
<span id="cb33-136"><a href="#cb33-136" aria-hidden="true" tabindex="-1"></a>        <span class="kw">break-after</span><span class="ch">:</span> <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-137"><a href="#cb33-137" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-138"><a href="#cb33-138" aria-hidden="true" tabindex="-1"></a>    code {</span>
<span id="cb33-139"><a href="#cb33-139" aria-hidden="true" tabindex="-1"></a>        <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">normal</span><span class="op">;</span></span>
<span id="cb33-140"><a href="#cb33-140" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-141"><a href="#cb33-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-142"><a href="#cb33-142" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== 汎用 ====*/</span></span>
<span id="cb33-143"><a href="#cb33-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-144"><a href="#cb33-144" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*==== 印刷 時 ====*/</span></span>
<span id="cb33-145"><a href="#cb33-145" aria-hidden="true" tabindex="-1"></a>    <span class="im">@media</span> <span class="an">print</span> {</span>
<span id="cb33-146"><a href="#cb33-146" aria-hidden="true" tabindex="-1"></a>        figure {</span>
<span id="cb33-147"><a href="#cb33-147" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break-inside</span><span class="ch">:</span> <span class="dv">avoid</span><span class="op">;</span></span>
<span id="cb33-148"><a href="#cb33-148" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb33-149"><a href="#cb33-149" aria-hidden="true" tabindex="-1"></a>        div <span class="op">&gt;</span> table {</span>
<span id="cb33-150"><a href="#cb33-150" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break-inside</span><span class="ch">:</span> <span class="dv">avoid-page</span><span class="op">;</span></span>
<span id="cb33-151"><a href="#cb33-151" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb33-152"><a href="#cb33-152" aria-hidden="true" tabindex="-1"></a>        div <span class="op">&gt;</span> table <span class="op">&gt;</span> tbody td {</span>
<span id="cb33-153"><a href="#cb33-153" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break-inside</span><span class="ch">:</span> <span class="dv">avoid</span><span class="op">;</span></span>
<span id="cb33-154"><a href="#cb33-154" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb33-155"><a href="#cb33-155" aria-hidden="true" tabindex="-1"></a>        div {</span>
<span id="cb33-156"><a href="#cb33-156" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break-inside</span><span class="ch">:</span> <span class="dv">avoid</span><span class="op">;</span></span>
<span id="cb33-157"><a href="#cb33-157" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb33-158"><a href="#cb33-158" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-159"><a href="#cb33-159" aria-hidden="true" tabindex="-1"></a>&lt;/style<span class="op">&gt;</span></span></code></pre></div>
<h2
id="サンプル制御ファイル利用上のポイント">サンプル制御ファイル利用上のポイント</h2>
<h3 id="章番号などの参照">章番号などの参照</h3>
<p>章番号などを参照する時に、単に<code>[@sec:id]</code>と書くと、参照文字列が「第1」となってしまいます。本来は、「第1章」のように、末尾に「章」や「節」を表示すべきです。</p>
<p>pandoc-crossrefには、自動的に末尾に「章」などを付ける機能ために使えるがありません。仕方がありませんので、参照する箇所のsuffixとして「章」などを付けています。</p>
<pre><code>[@sec:id章]</code></pre>
<h3 id="例示のコード">例示のコード</h3>
<p>すぐ上に掲載したようなコードの例示は、HTMLの機能を使って実現しています。マークダウン原稿では、以下のように書いています。</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;indentedColoredBox&quot;</span><span class="ot"> </span><span class="dt">&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    \[\@sec:id章\]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
</body>
</html>
