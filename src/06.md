# KDP用原稿のための配慮

## タイトルページを消す

KDPでは、原稿登録時に、表紙を本文とは別に指定します。
ですから、中表紙とみなすなら別ですが、EPUBに表紙を含めてはいけません。

Pandocのデフォルトでは表紙を作るようになっていますから、これを消しましょう。

コマンドラインに`--epub-title-page=false`というオプションを追加して消します。

```
pandoc -d Pandoc.yaml --epub-title-page=false
```

Pandocのドキュメントでは、このオプションをpandoc.yamlにも書けることになっていますが、残念ながらVersion.3.1.2で確認してみるとエラーになってしまいます。コマンドラインで指定しましょう。

## 目次を消す

KDPにEPUBを登録する時には目次が必須ですが、ナビゲーション用の目次が用意されていれば良いのであって、本文中に目次が含まれていなければならないということではありません。
PandocでEPUBを作ると、ナビゲーション用の目次は必ず作られます。
本文の一部として目次を作るか否かは著者が決めて問題ありません。
特に書籍が大きい場合には目次が長くなりがちです。そのような時には目次を本文から削除したくなります。

目次を本文から削除するには、pandoc.yamlに以下の行を追加してください。

```
toc:false
```

これで本文から目次が削除されます。
この設定にかかわらず、ナビゲーション用の目次は作られますので、KDPの要件は満たされます。

## 図表一覧を作る

Markdownの適当なところにコマンドを挿入することにより、図・表・リスティングの一覧を作れます。
表とリスティングの一覧の作り方は図一覧とほぼ同一ですから、以下では図一覧について説明します。

表とリスティングの一覧については、表25に掲げる対応表をご覧ください。
残念なことに、図表一覧から各図などへのリンクは、張られません。

### 図一覧のMarkdown

図一覧のMarkdownは、以下の通りです。

```
\listoffigures
```

5.7.3項のリスト 38で例示に使った図の一覧を作ると、図44の様に表示されます。

図44:図一覧

このように、図一覧には、図だけではなくサブフィギュアも含まれます。

### 図一覧の書式制御

#### 図一覧のタイトル

図表一覧のタイトルは、変数`lofTitle`の値です。  
デフォルト値は`# List of Figures`です。  
先頭の`#`は、レベル1のヘッダを表すMarkdown記法です。

#### 図一覧本体の書式

図一覧の各行は、以下の構造により作られます。


図45:図一覧本体の書式

図番号は、図5に掲げる変数`refIndexTemplate`による書式制御に従います。
つまり、4.2節で説明した図を参照する時と同じ書式になります。
ただし、pandoc-crossrefがプレフィックスとサフィックスを付けないので、結果的には図45の構造になっています。
この構造は、プレフィックスを省略する参照のMarkdown「`[-@fig:id]`」を書いた時と同じものです。

サブフィギュアの場合には、以下の構造により作られます。

図46:図一覧本体中サブフィギュアの書式

サブフィギュアがある場合には、図40に掲げる変数`subfigureRefIndexTemplate`に従って作られた文字列が使われます。
こちらもpandoc-crossrefがプレフィックスとサフィックスを付けないので、結果的に図46の構造になっています。
こちらも、プレフィックスを省略する参照のMarkdown「`[-@fig:subfigid]`」を書いた時と同じものです。

表24:図一覧の各行の文字列の部品

|要素 |役割 |デフォルト値 |
|- |- |- |
|変数`lofItemTitle` |各行の先頭に付ける文字列|空文字列|
|変数`listItemTitleDelim` |参照文字列とキャプションを区切る文字列|`.`|

他の部品については、5.2節の表9と5.7節の表22をご覧ください。

### 生成される図一覧のHTML

図の一覧は、一つずつの図などごとにbr要素で改行されているだけの単なる文字列をdiv要素で括ったものです。

リスト42:図一覧のHTML
```html
<h1>ListofFigures</h1>
<div class="listlist-of-fig">
1. GroupCaption<br>

1 (a). BigCaption1<br>

1 (b). MiddleCaption1<br>

1 (c). SmallCaption1<br>

1 (d). BigCaption1<br>

</div>
```

図一覧のタイトルは、変数`lofTitle`のデフォルト値の通り、レベル1のヘッダになっています。
図一覧本体を括るdiv要素には、図一覧であることを
表すクラスが付けられます。

### 図表一覧の書式制御まとめ

表とリスティングの一覧も図一覧と同じ方法で作れます。
表25に記法や書式制御変数の対応表を掲げます。

表25:図表一覧の記法対応表

|一覧|Markdown記法|行タイトル|番号の書式|div要素のクラス|
|- |- |- |- |- |
|図|`\listoffigures`|変数`lofItemTitle`|変数`refIndexTemplate`|`list list-of-fig`|
|図（サブフィギュアの場合）|`-`|同上|変数`subfigureRefIndexTemplate`|`-`|
|表|`\listoftables`|変数`lotItemTitle`|変数`refIndexTemplate`|`list list-of-tbl`|
|リスティング|`\listoflistings`|変数`lolItemTitle`|変数`refIndexTemplate`|`list list-of-lst`|

変数`refIndexTemplate`が連番の書式として図・表・リスティングのすべてに使われていますが、種類ごとに連番の書式を変えたい場合には4.3節で説明したように、変数`refIndexTemplate`をディクショナリーにしてください。

